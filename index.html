<!doctype html>
<html>
    <head>
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
        <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>
        <style>
            .header, .footer {
                position: absolute;
                left: 0;
                width: 100%;
                padding: 10px 0;
                background: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(10px);
                z-index: 10;
                text-align: center;
            }

            .header {
                top: 0;
            }

            .footer {
                bottom: 0;
            }

            h1 {
                color: white;
                font-family: Arial, sans-serif;
                font-size: 2em;
                margin: 0;
            }

            p {
                color: rgb(200, 200, 200);
                font-family: Arial, sans-serif;
                font-size: 0.8em;
                margin: 0;
            }
        </style>
    </head>

    <body style="margin: 0; overflow: hidden;">
        <div class="header">
            <h1>G-RCP ARG</h1>
        </div>
        
        <a-scene
            vr-mode-ui="enabled: false;"
            loading-screen="enabled: false;"
            renderer="logarithmicDepthBuffer: true;"
            arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
            embedded
            gesture-detector
        >

            <!-- Marcadores y modelos -->
            <a-marker id="marker1" type="pattern" preset="custom" url="assets/pattern-1.patt" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
                <a-entity id="model1" scale="1 1 1" animation-mixer="loop: repeat" class="clickable" gesture-handler visible="false"></a-entity>
            </a-marker>

            <a-marker id="marker2" type="pattern" preset="custom" url="assets/pattern-2.patt" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
                <a-entity id="model2" scale="1 1 1" animation-mixer="loop: repeat" class="clickable" gesture-handler visible="false"></a-entity>
            </a-marker>

            <a-marker id="marker3" type="pattern" preset="custom" url="assets/pattern-3.patt" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
                <a-entity id="model3" scale="2 2 2" animation-mixer="loop: repeat" class="clickable" gesture-handler visible="false"></a-entity>
            </a-marker>

            <a-marker id="marker4" type="pattern" preset="custom" url="assets/pattern-4.patt" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
                <a-entity id="model4" scale="2 2 2" animation-mixer="loop: repeat" class="clickable" gesture-handler visible="false"></a-entity>
            </a-marker>

            <a-marker id="marker5" type="pattern" preset="custom" url="assets/pattern-5.patt" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
                <a-entity id="model5" scale="2 2 2" animation-mixer="loop: repeat" class="clickable" gesture-handler visible="false"></a-entity>
            </a-marker>

            <a-entity camera></a-entity>
        </a-scene>

        <div class="footer">
            <p>Developed by Julian Peruzzi</p>
        </div>

        <script>
            AFRAME.registerComponent('load-model-on-detect', {
                init: function () {
                    var marker = this.el;
                    var model = document.querySelector('#' + marker.id.replace('marker', 'model'));

                    marker.addEventListener('markerFound', function () {
                        if (!model.hasLoaded) {
                            model.setAttribute('gltf-model', 'url(assets/' + marker.id.replace('marker', 'model') + '.glb)');
                            model.hasLoaded = true;
                        }
                        model.setAttribute('visible', true);
                    });

                    marker.addEventListener('markerLost', function () {
                        model.setAttribute('visible', false);
                    });
                }
            });

            // Asignar el componente personalizado a cada marcador
            document.querySelectorAll('a-marker').forEach(function (marker) {
                marker.setAttribute('load-model-on-detect', '');
            });
        </script>
    </body>
</html>
